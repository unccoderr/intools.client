import { useContext, useEffect } from "react"
import { useNavigate, useParams } from "react-router-dom"
import { useLocalization } from "../../Hooks"

import { AppContext } from "../../app"
import { SwitchList, ConstructorBlock, ProfileBuilderContextProvider, ProfileBuilderContext } from "./Components"
import './builder--screen.css'

import { header, tabList, exportButton, DATA_KEYS } from "../../Config"

export const BuilderScreen = () => {
	let { id: profileID } = useParams<{ id: string }>()
	const navigate = useNavigate()
	const { language, setOpenBuilderModal } = useContext(AppContext)
	const { localize } = new useLocalization(language)

	const showBuilderModal = () => {
		if (setOpenBuilderModal) setOpenBuilderModal(true)
	}

	useEffect(() => {
		if (!localStorage.getItem(DATA_KEYS.CLOSED_BUILDER_MODAL)) showBuilderModal()
	}, [])


	return <ProfileBuilderContextProvider profileID={profileID ? +profileID : 0}>
		<ProfileBuilderContext.Consumer>
			{ ({ resetProfile, removeProfile, exportProfile }) => <main className={'builderScreen'}>
				<div className={'constructorBlock--wrapper'}>
					<div className="builderScreen--header">
						<button onClick={() => navigate('/')}>
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M20 12H4M4 12L10 5M4 12L10 19" stroke="black" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
							</svg>
						</button>
						<h1>
							{localize(header)}
							<img src={require('../../Assets/Images/BuilderIcon.png')} alt={'builder emoji'}/>
						</h1>
						<button onClick={showBuilderModal}>
							<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<circle cx="6.5" cy="11.5" r="1.5" fill="black"/>
								<circle cx="12" cy="11.5" r="1.5" fill="black"/>
								<circle cx="17.5" cy="11.5" r="1.5" fill="black"/>
							</svg>
						</button>
					</div>
					<ul className={'builderScreen--tabs'}>
						<li className={'builderScreen--tab builderScreen--tab-primary'}>
							<button>
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M20.9923 8.29204C20.9501 7.33564 20.7954 6.67811 20.5739 6.10836C20.3453 5.50358 19.9937 4.96213 19.533 4.51201C19.0829 4.05489 18.5378 3.69969 17.9401 3.4747C17.367 3.25315 16.7129 3.09848 15.7565 3.05632C14.793 3.01058 14.4871 3 12.0433 3C9.59942 3 9.29353 3.01058 8.33355 3.05274C7.37714 3.09491 6.71962 3.24971 6.15 3.47113C5.54509 3.69969 5.00363 4.05132 4.55352 4.51201C4.0964 4.96213 3.74133 5.50715 3.51621 6.10493C3.29465 6.67811 3.13999 7.33206 3.09782 8.28847C3.05208 9.25202 3.0415 9.55791 3.0415 12.0017C3.0415 14.4456 3.05208 14.7515 3.09425 15.7115C3.13642 16.6679 3.29122 17.3254 3.51277 17.8951C3.74133 18.4999 4.0964 19.0414 4.55352 19.4915C5.00363 19.9486 5.54866 20.3038 6.14643 20.5288C6.71962 20.7503 7.37357 20.905 8.33011 20.9472C9.28996 20.9895 9.59598 20.9999 12.0398 20.9999C14.4837 20.9999 14.7895 20.9895 15.7495 20.9472C16.7059 20.905 17.3635 20.7503 17.9331 20.5288C19.1428 20.0611 20.0992 19.1047 20.5669 17.8951C20.7883 17.3219 20.9431 16.6679 20.9853 15.7115C21.0274 14.7515 21.038 14.4456 21.038 12.0017C21.038 9.55791 21.0344 9.25202 20.9923 8.29204ZM19.3713 15.6411C19.3326 16.5202 19.1849 16.9949 19.0619 17.3114C18.7594 18.0955 18.137 18.7179 17.3529 19.0204C17.0364 19.1434 16.5583 19.2911 15.6826 19.3297C14.7332 19.372 14.4485 19.3824 12.0468 19.3824C9.64516 19.3824 9.35685 19.372 8.41088 19.3297C7.5318 19.2911 7.0571 19.1434 6.74063 19.0204C6.3504 18.8761 5.9952 18.6476 5.70689 18.3487C5.40801 18.0568 5.17945 17.7052 5.03522 17.3149C4.91215 16.9985 4.76449 16.5202 4.7259 15.6447C4.68359 14.6953 4.67315 14.4104 4.67315 12.0088C4.67315 9.60709 4.68359 9.31878 4.7259 8.37295C4.76449 7.49387 4.91215 7.01917 5.03522 6.7027C5.17945 6.31233 5.40801 5.95727 5.71046 5.66882C6.00221 5.36994 6.35384 5.14138 6.7442 4.99729C7.06067 4.87422 7.53894 4.72656 8.41445 4.68783C9.36385 4.64566 9.64873 4.63508 12.0503 4.63508C14.4555 4.63508 14.7402 4.64566 15.6862 4.68783C16.5653 4.72656 17.04 4.87422 17.3564 4.99729C17.7467 5.14138 18.1019 5.36994 18.3902 5.66882C18.6891 5.9607 18.9176 6.31233 19.0619 6.7027C19.1849 7.01917 19.3326 7.4973 19.3713 8.37295C19.4135 9.32235 19.4241 9.60709 19.4241 12.0088C19.4241 14.4104 19.4135 14.6917 19.3713 15.6411Z" />
									<path d="M12.0434 7.37782C9.49062 7.37782 7.41943 9.44887 7.41943 12.0018C7.41943 14.5547 9.49062 16.6257 12.0434 16.6257C14.5963 16.6257 16.6673 14.5547 16.6673 12.0018C16.6673 9.44887 14.5963 7.37782 12.0434 7.37782ZM12.0434 15.0012C10.3873 15.0012 9.04394 13.658 9.04394 12.0018C9.04394 10.3455 10.3873 9.00233 12.0434 9.00233C13.6996 9.00233 15.0428 10.3455 15.0428 12.0018C15.0428 13.658 13.6996 15.0012 12.0434 15.0012Z" />
									<path d="M17.9296 7.19476C17.9296 7.79088 17.4462 8.27424 16.85 8.27424C16.2539 8.27424 15.7705 7.79088 15.7705 7.19476C15.7705 6.5985 16.2539 6.11528 16.85 6.11528C17.4462 6.11528 17.9296 6.5985 17.9296 7.19476Z" fill="white"/>
								</svg>
								{localize(tabList.import)}
							</button>
						</li>
						<li className={'builderScreen--tab'}>
							<button onClick={resetProfile}>
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M5.14844 13.0557C5.14844 16.9307 8.25781 20.0479 12.125 20.0479C15.9922 20.0479 19.1016 16.9307 19.1016 13.0557C19.1016 9.18848 16.0156 6.09473 12.1484 6.09473C11.7422 6.09473 11.3438 6.13379 11 6.2041L12.8906 4.33691C13.0234 4.19629 13.1016 4.0166 13.1016 3.81348C13.1016 3.3916 12.7734 3.04785 12.3594 3.04785C12.1406 3.04785 11.9531 3.12598 11.8203 3.27441L8.61719 6.53223C8.46094 6.68848 8.375 6.8916 8.375 7.09473C8.375 7.30566 8.45312 7.49316 8.61719 7.65723L11.8203 10.8916C11.9531 11.0322 12.1328 11.1025 12.3594 11.1025C12.7734 11.1025 13.1016 10.7744 13.1016 10.3447C13.1016 10.1416 13.0234 9.97754 12.8828 9.8291L10.7578 7.71973C11.1562 7.63379 11.6328 7.59473 12.1484 7.59473C15.1719 7.59473 17.5703 10.0088 17.5703 13.0557C17.5703 16.0869 15.1484 18.5166 12.125 18.5166C9.10156 18.5166 6.67969 16.0869 6.67969 13.0557C6.67969 12.5947 6.38281 12.2666 5.92969 12.2666C5.46875 12.2666 5.14844 12.5947 5.14844 13.0557Z" />
								</svg>
								{localize(tabList.reset)}
							</button>
						</li>
						<li className={'builderScreen--tab'}>
							<button onClick={removeProfile}>
								<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<path d="M17.5775 18.7049L18.1234 7.58456H18.9146C19.2389 7.58456 19.5 7.32595 19.5 7.01409C19.5 6.70224 19.2389 6.43602 18.9146 6.43602H15.4573V5.29508C15.4573 4.20738 14.6899 3.5 13.4715 3.5H10.5127C9.2943 3.5 8.53481 4.20738 8.53481 5.29508V6.43602H5.09335C4.7769 6.43602 4.5 6.70224 4.5 7.01409C4.5 7.32595 4.7769 7.58456 5.09335 7.58456H5.88449L6.43038 18.7125C6.48576 19.8078 7.23734 20.5 8.37658 20.5H15.6313C16.7627 20.5 17.5222 19.8002 17.5775 18.7049ZM9.80063 5.37114C9.80063 4.93758 10.1329 4.63333 10.6076 4.63333H13.3845C13.8671 4.63333 14.1994 4.93758 14.1994 5.37114V6.43602H9.80063V5.37114ZM8.49525 19.3591C8.03639 19.3591 7.6962 19.0244 7.67247 18.5832L7.11867 7.58456H16.8576L16.3354 18.5832C16.3117 19.032 15.9794 19.3591 15.5127 19.3591H8.49525ZM14.3497 18.0204C14.6108 18.0204 14.8085 17.815 14.8165 17.526L15.0538 9.49374C15.0617 9.2047 14.856 8.99172 14.587 8.99172C14.3418 8.99172 14.1361 9.2123 14.1282 9.48613L13.8908 17.526C13.8829 17.7998 14.0807 18.0204 14.3497 18.0204ZM9.65823 18.0204C9.92722 18.0204 10.125 17.7998 10.1171 17.526L9.87975 9.48613C9.87184 9.2123 9.65823 8.99172 9.41297 8.99172C9.14399 8.99172 8.9462 9.2047 8.95411 9.49374L9.19937 17.526C9.20728 17.815 9.39715 18.0204 9.65823 18.0204ZM12.4826 17.526V9.48613C12.4826 9.2123 12.269 8.99172 12.0079 8.99172C11.7468 8.99172 11.5253 9.2123 11.5253 9.48613V17.526C11.5253 17.7998 11.7468 18.0204 12.0079 18.0204C12.2611 18.0204 12.4826 17.7998 12.4826 17.526Z" />
								</svg>
								{localize(tabList.delete)}
							</button>
						</li>
					</ul>
					<SwitchList className={'builderScreen--switchList'} />
					<button className={'builderScreen--button'} onClick={exportProfile}>
						{localize(exportButton)}
					</button>
				</div>
				<ConstructorBlock profileID={profileID ? +profileID : 0} />
			</main> }
		</ProfileBuilderContext.Consumer>
	</ProfileBuilderContextProvider>
}